<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Max Gordon" />

<meta name="date" content="2018-03-20" />

<title>How to use the timeSplitter</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">How to use the timeSplitter</h1>
<h4 class="author"><em>Max Gordon</em></h4>
<h4 class="date"><em>2018-03-20</em></h4>



<div id="background" class="section level1">
<h1>Background</h1>
<p>When working with <strong>survival</strong> data it is important to remember that the effects may change in time. This is rarely something you notice in datasets of a few hundreds but as the datasets grow larger the chances of this happening increase. When doing a simple Cox regression with the survival package this can be easily checked for using the <code>cox.zph</code> function.</p>
<div id="the-problem-with-non-proportional-hazards" class="section level2">
<h2>The problem with non-proportional hazards</h2>
<p>The main effect of non-proportional hazards is that you will have a mean estimate over the study time. This mean does not distribute evenly throughout the studied time period but evenly according to the observed time, i.e. if you have the longest observation period being 20 years while &gt; 50% of your patients have a follow-up of less than 10 years the effect. Note that this may further depend on how the events are distributed. Thus it is useful to be able to deal with non-proportional hazards.</p>
</div>
<div id="addressing-non-proportional-hazards" class="section level2">
<h2>Addressing non-proportional hazards</h2>
<div id="using-strata" class="section level3">
<h3>Using <code>strata</code></h3>
<p>The Cox model allows you to estimate effects in different strata and then average them together. If your confounder that breaks the proportionality assumption is a non-continuous variable this is a convenient method that allows you to set-up the necessary strata. With one variable this is simple, <code>Surv(time, event) ~ x_1 + x_2 + strata(x_np)</code>, but with multiple variables you risk of ending up with small strata and the non-informative error:</p>
<blockquote>
<p>attempt to select less than one element</p>
</blockquote>
<p>Note that you should not multiple strata but combine the variables, e.g. if you have two variables called <code>x_np1</code> and <code>x_np2</code> you would set up your model with the strata as <code>strata(x_np1, x_np2)</code>. The strata is then handled as interactions generating <code>nlevels(x_np1) * nlevels(x_np2)</code> which seems also to be the core reason for why this fails.</p>
</div>
<div id="using-the-tt-argument" class="section level3">
<h3>Using the <code>tt</code> argument</h3>
<p>The survival package has an excellent vignette om time-dependent variables and time-dependent coefficients, see <code>vignette(&quot;timedep&quot;, package = &quot;survival&quot;)</code>. Prof. Therneau explains there common pitfalls and how to use a time-transforming option provided by the <code>coxph</code> function through the <code>tt</code> argument. It is a neat an simple solution that transforms those variables that you have indicated for transformation using the <code>tt</code> function. The vignette provides some simple approaches but it also allows for a rather sophisticated use:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(survival)
<span class="kw">coxph</span>(<span class="kw">Surv</span>(time, event) <span class="op">~</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>sex <span class="op">+</span><span class="st"> </span>
<span class="st">        </span>type_of_surgery <span class="op">+</span><span class="st"> </span><span class="kw">tt</span>(type_of_surgery) <span class="op">+</span><span class="st"> </span>
<span class="st">        </span><span class="kw">tt</span>(surgery_length),
      <span class="dt">data =</span> my_surgical_data,
      <span class="dt">tt =</span> <span class="kw">list</span>(
        <span class="cf">function</span>(type_of_surgery, time, ...){
          <span class="co"># As type_of_surgery is a categorical variable</span>
          <span class="co"># we must transform it into a design matrix that </span>
          <span class="co"># we can use for multiplication with time</span>
          <span class="co"># Note: the [,-1] is for dropping the intercept</span>
          mtrx &lt;-<span class="st"> </span><span class="kw">model.matrix</span>(<span class="op">~</span>type_of_surgery)[,<span class="op">-</span><span class="dv">1</span>]
          mtrx <span class="op">*</span><span class="st"> </span>time
        },
        <span class="cf">function</span>(surgery_length, time, ...){
          <span class="co"># Note that the surgery_length and the time</span>
          <span class="co"># should probably have similar ranges. If you</span>
          <span class="co"># report operating time in minutes, follow-up</span>
          <span class="co"># in years the t will be dwarfed by the </span>
          <span class="kw">pspline</span>(surgery_length <span class="op">+</span><span class="st"> </span>time)
        }
      ))</code></pre></div>
<p>The main problem is that it doesn’t scale all that well to larger datasets. A common error unless you have a large amount of memory is:</p>
<blockquote>
<p>Could not allocate vector of *** MB</p>
</blockquote>
</div>
<div id="using-the-timesplitter" class="section level3">
<h3>Using the timeSplitter</h3>
<p>The <code>tt</code> approach is based upon the idea of time splitting. Time splitting is possible since the Cox proportional hazards model studies the derivative of the survival function, i.e. the hazard, and thus doesn’t care how many observations were present before the current derivative. This allows including patients/observations after 2 years by ignoring them prior to 2 years. The method is referred to as <em>interval time</em> where the <code>Surv(time, event)</code> simply changes into <code>Surv(Start_time, Stop_time, event)</code>.</p>
<p>This allows us to adjust for time interactions as the <code>Start_time</code> is independent of the event. In our standard setting the <code>Start_time</code> is always 0 but if we split an observation into multiple time steps and use the <em>interval time</em> the variable will become meaningful in an interaction setting. Note that [!ref] suggested that one uses the <code>End_time</code> after splitting the observation time, while I’ve found that it in practice doesn’t matter that much - it makes intuitive sense to use the <code>Start_time</code> if we make the time interval too large the <code>End_time</code> will convey information about the event status and thereby by nature become significant. The approach explained in more detail below.</p>
</div>
<div id="poor-mans-time-split" class="section level3">
<h3>Poor-mans time split</h3>
<p>An alternative is to split the data into a few intervals, select one interval at the time and perform separate models on each. This will result in multiple estimates per variable, poorer statistical power and most likely an incomplete handling of the non-proportional hazards. Despite these downsides it may still be a viable solution when presenting to a less statistically savvy audience in order to gain acceptance for above methods. The <code>timeSplitter</code> can help generating the datasets necessary, here’s a convenient example using <code>dplyr</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(plyr)
<span class="kw">library</span>(magrittr)
models &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">timeSplitter</span>(your_data, 
               <span class="dt">by =</span> <span class="dv">4</span>,
               <span class="dt">event_var =</span> <span class="st">&quot;status&quot;</span>,
               <span class="dt">time_var =</span> <span class="st">&quot;years&quot;</span>,
               <span class="dt">event_start_status =</span> <span class="st">&quot;alive&quot;</span>,
               <span class="dt">time_related_vars =</span> <span class="kw">c</span>(<span class="st">&quot;age&quot;</span>, <span class="st">&quot;date&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">dlply</span>(<span class="st">&quot;Start_time&quot;</span>,
        <span class="cf">function</span>(data){
          <span class="kw">coxph</span>(<span class="kw">Surv</span>(Start_time, End_time, status) <span class="op">~</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>sex <span class="op">+</span><span class="st"> </span>treatment, <span class="dt">data =</span> data)
        })</code></pre></div>
</div>
<div id="other-options" class="section level3">
<h3>Other options</h3>
<p>These approaches are probably just a subset of possible approaches. I know of the <a href="https://github.com/scheike/timereg">timereg</a> package that has some very fancy time coefficient handling. My personal experience with the package is limited and I’ve been discouraged by the visually less appealing graphs provided in the examples and there isn’t a proper vignette explaining the details (Last checked v 1.8.9). Similarly the <a href="http://www.plosone.org/article/info%3Adoi%2F10.1371%2Fjournal.pone.0047804">flexsurv</a> should be able to deal with the proportional hazards assumption. If you know any other then please send me an e-mail.</p>
</div>
</div>
</div>
<div id="how-the-timesplitter-works" class="section level1">
<h1>How the timeSplitter works</h1>
<p>First we generate a short survival dataset with 4 observations.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(Greg)
test_data &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">id =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>,
  <span class="dt">time =</span> <span class="kw">c</span>(<span class="dv">4</span>, <span class="fl">3.5</span>, <span class="dv">1</span>, <span class="dv">5</span>),
  <span class="dt">event =</span> <span class="kw">c</span>(<span class="st">&quot;censored&quot;</span>, <span class="st">&quot;dead&quot;</span>, <span class="st">&quot;alive&quot;</span>, <span class="st">&quot;dead&quot;</span>),
  <span class="dt">age =</span> <span class="kw">c</span>(<span class="fl">62.2</span>, <span class="fl">55.3</span>, <span class="fl">73.7</span>, <span class="fl">46.3</span>),
  <span class="dt">date =</span> <span class="kw">as.Date</span>(
    <span class="kw">c</span>(<span class="st">&quot;2003-01-01&quot;</span>, 
      <span class="st">&quot;2010-04-01&quot;</span>, 
      <span class="st">&quot;2013-09-20&quot;</span>,
      <span class="st">&quot;2002-02-23&quot;</span>))
)

test_data<span class="op">$</span>time_str &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;0 to %.1f&quot;</span>, test_data<span class="op">$</span>time)</code></pre></div>
<p>Using some grid-graphics we can illustrate the dataset graphically:</p>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAqAAAAGACAMAAABFpiBcAAABDlBMVEUAAAAAADoAAGYAOJAAOjoAOmYAOpAAYrYAZpAAZrY4AAA4ADo4ODo4OGY4YpA4its6AAA6ADo6AGY6OgA6Ojo6OmY6ZmY6ZpA6ZrY6kNtiAABiOGZiipBisP9mAABmOgBmOjpmZpBmkLZmtttmtv+KOACKYgCKYmaK0/+QOgCQZgCQZjqQZmaQkLaQtraQttuQ29uQ2/+wYgCwYjqwimaw09uw9tuw9v+2ZgC2Zjq2kGa2tpC225C229u22/+2///TijrTsJDT09vT9v/bkDrbtmbbtpDbtrbb27bb2//b/7bb/9vb///2sGb205D209v29rb29tv29v//tmb/25D/27b/29v//7b//9v///+73BKdAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAOeElEQVR4nO3dYWPbxAGH8XPaJkuBJTAYc2CBjWQ0sI01BWrYRg11O9jikERpY3//LzKdTrIl2U7jOyn6K3p+L7I0ls6O9eROUjpqpoAw0/QLAK5DoJBGoJBGoJBGoJBGoJBGoJBGoJBGoJBGoJBGoJBGoJBGoJBGoJBGoJBGoJBGoJBGoJBGoJBGoJBGoJBGoJBGoJBGoJBGoJBGoJBGoJBGoJBGoJBGoJBGoJBGoJBGoJBGoJBGoJBGoJBGoJBGoJBGoJBGoJBGoJBGoJBGoJBGoJBGoJBGoJBGoJBGoJBGoJBGoJBGoJDW8UBHpqw/nRyZjWdNvzCkCJRApREogUrreKCpq32aFEWgFoHKIlCLQGURqFUIND0Hjb+2eTJ58TtjHnxlv/r9rjH3P5tt9OL9+IT1g69OykO5B+7/+ZfkT5e7Znv66lNjen/4Jdvi9fd2i94HX82fbfJ9/DS9D39YOka3Eai1KtD/HWVXTq8+cZ9tu23i8JwHPxRHmj0Q7+P+uJ1+qffYbTG/Lts8SZ/tX9lOB8vG6DYCtVYF+kUaSu8fRybf0Dyh0qlBvJPJbxlv+JtsV1do/r5B3z3bXLJJeYxuI1BrRaDxBPnv6fTVfjZVvtx1U6h9yK77kxe7sznVGbldpq+O3ASZlGx3fZHbNVntf/7EbZEE2vvsZDr5Lk22PEa3Eai1KlDXR2Ryn9lPolk58UbZ0p0YZJNeOogN1G0af2a3jPJnCXYLG2j63CP3WHmMbiNQa1WgB9mjaYXpdoN5lVHxRDFubDN/VppmaQ1Kp5TpWDbQ/mxjG3N5jG4jUGtFoOnXyp8l1/fpxsll+lyUnEn+/m+5h7NNo/zZwOv//HXXZIFmCacbl8foNgK11g40r3CeOMgud9w9oly/2aeTl59ml1jLAy2P0W0Eaq0XaO4afiHQ5Hbp/Bq9GOjssun6QEtjdBuBWmsHet3V9csv53UtzKBu9r3/wZ/+/t/9VYGWxug2ArXWXuLfcHX9+p9fuql14Rx0NLu3f3VdoPkxuo1ArfUCtRfey++g524MzSbb7AvJ3aNcjtGKJX5hjG4jUGu9QO00uJHeCBoVV+H5vaT56apb412q8xzt7f/lM2h5jG4jUGvNQO2JpP3lz/T1d6Z4o97eIpr9omg7vST68If575wGbol310F21+W3mfJjdBuBWmsG6m5VLr2MGcwfSH+TdD9/U6mw54pAy2N0G4Fa6wY6jVbdCJr/3Y8HNjt76Z42+cAN8d3sJqc7k112m6k4RrcRqLV2oPEaveqvbP78pY03/Zuiyb2ly0/yf5P05afJjifpZf3Sq/jCGN1GoLUq/SYUayPQWhFoKAKtFYGGItBaEWgoAq0VgYYi0FoRaCgChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQChTQC7a5WHPv6X+Tle8+Cx4iM6T3OPj9YssFg82TJpriWMS1ItPaXeLW/ERxoFCcXpdld7S8JNDJZoPlNfbXhuFXBmBYkWvcLjCe04EAnR/3442A7+cOyQK/2s0ALm/oxrThuVWjFd1rz64tMPwoO9HLXNjlKxrncNTbGuHvTn20w2vwiDTS/qadWHLZKGNOC77X+V1dBoO8+no+TzKCROYg/2Z4/np2DFjb10oqjVg1jWvDNtiFQd06ZnlnaQN1Cnp1q2j9lgRY29WI6KfAI1aiVgbqF3H20C/xJhYF2cImX/mbbEOjCEu/STC+XkkerW+K7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" /><!-- --></p>
<p>Now we apply a split that splits the data into 2 year chunks. <strong>Note</strong>: 2 years as in this example is probably not optimal, only chosen in order to make it easier to display.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)
split_data &lt;-<span class="st"> </span>
<span class="st">  </span>test_data <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(id, event, time, age, date) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">timeSplitter</span>(<span class="dt">by =</span> <span class="dv">2</span>, <span class="co"># The time that we want to split by</span>
               <span class="dt">event_var =</span> <span class="st">&quot;event&quot;</span>,
               <span class="dt">time_var =</span> <span class="st">&quot;time&quot;</span>,
               <span class="dt">event_start_status =</span> <span class="st">&quot;alive&quot;</span>,
               <span class="dt">time_related_vars =</span> <span class="kw">c</span>(<span class="st">&quot;age&quot;</span>, <span class="st">&quot;date&quot;</span>))

knitr<span class="op">::</span><span class="kw">kable</span>(<span class="kw">head</span>(split_data, <span class="dv">10</span>))</code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">id</th>
<th align="left">event</th>
<th align="right">age</th>
<th align="right">date</th>
<th align="right">Start_time</th>
<th align="right">Stop_time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">alive</td>
<td align="right">62.2</td>
<td align="right">2002.999</td>
<td align="right">0</td>
<td align="right">2.0</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">censored</td>
<td align="right">64.2</td>
<td align="right">2004.999</td>
<td align="right">2</td>
<td align="right">4.0</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="left">alive</td>
<td align="right">55.3</td>
<td align="right">2010.246</td>
<td align="right">0</td>
<td align="right">2.0</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">dead</td>
<td align="right">57.3</td>
<td align="right">2012.246</td>
<td align="right">2</td>
<td align="right">3.5</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="left">alive</td>
<td align="right">73.7</td>
<td align="right">2013.718</td>
<td align="right">0</td>
<td align="right">1.0</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">alive</td>
<td align="right">46.3</td>
<td align="right">2002.145</td>
<td align="right">0</td>
<td align="right">2.0</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="left">alive</td>
<td align="right">48.3</td>
<td align="right">2004.145</td>
<td align="right">2</td>
<td align="right">4.0</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">dead</td>
<td align="right">50.3</td>
<td align="right">2006.145</td>
<td align="right">4</td>
<td align="right">5.0</td>
</tr>
</tbody>
</table>
<p>Now if we plot each individual’s interval times below the original see multiple observation times where only the last observation time is related to the actual event. All prior are assumed to have unchanged event status from the original status.</p>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
<div id="a-real-example" class="section level1">
<h1>A real example</h1>
<p>I haven’t found any good datasets with non-proportional hazards but the melanoma dataset is largish and allows some exploration.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># First we start with loading the dataset</span>
<span class="kw">data</span>(<span class="st">&quot;melanoma&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;boot&quot;</span>)

<span class="co"># Then we munge it according to ?boot::melanoma</span>
<span class="kw">library</span>(dplyr)
<span class="kw">library</span>(magrittr)
melanoma <span class="op">%&lt;&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">status =</span> <span class="kw">factor</span>(status,
                        <span class="dt">levels =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>,
                        <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Died from melanoma&quot;</span>, 
                                   <span class="st">&quot;Alive&quot;</span>, 
                                   <span class="st">&quot;Died from other causes&quot;</span>)),
        <span class="dt">ulcer =</span> <span class="kw">factor</span>(ulcer,
                       <span class="dt">levels =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>,
                       <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Absent&quot;</span>, <span class="st">&quot;Present&quot;</span>)),
        <span class="dt">time =</span> time<span class="op">/</span><span class="fl">365.25</span>, <span class="co"># All variables should be in the same time unit</span>
        <span class="dt">sex =</span> <span class="kw">factor</span>(sex,
                     <span class="dt">levels =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>,
                     <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Female&quot;</span>, <span class="st">&quot;Male&quot;</span>)))</code></pre></div>
<p>Now we can fit a regular cox regression:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(survival)
regular_model &lt;-<span class="st"> </span><span class="kw">coxph</span>(<span class="kw">Surv</span>(time, status <span class="op">==</span><span class="st"> &quot;Died from melanoma&quot;</span>) <span class="op">~</span>
<span class="st">                         </span>age <span class="op">+</span><span class="st"> </span>sex <span class="op">+</span><span class="st"> </span>year <span class="op">+</span><span class="st"> </span>thickness <span class="op">+</span><span class="st"> </span>ulcer,
                       <span class="dt">data =</span> melanoma,
                       <span class="dt">x =</span> <span class="ot">TRUE</span>, <span class="dt">y =</span> <span class="ot">TRUE</span>)
<span class="kw">summary</span>(regular_model)</code></pre></div>
<pre><code>## Call:
## coxph(formula = Surv(time, status == &quot;Died from melanoma&quot;) ~ 
##     age + sex + year + thickness + ulcer, data = melanoma, x = TRUE, 
##     y = TRUE)
## 
##   n= 205, number of events= 57 
## 
##                   coef exp(coef)  se(coef)      z Pr(&gt;|z|)    
## age           0.016805  1.016947  0.008578  1.959 0.050094 .  
## sexMale       0.448121  1.565368  0.266861  1.679 0.093107 .  
## year         -0.102566  0.902518  0.061007 -1.681 0.092719 .  
## thickness     0.100312  1.105516  0.038212  2.625 0.008660 ** 
## ulcerPresent  1.194555  3.302087  0.309254  3.863 0.000112 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
##              exp(coef) exp(-coef) lower .95 upper .95
## age             1.0169     0.9833    1.0000     1.034
## sexMale         1.5654     0.6388    0.9278     2.641
## year            0.9025     1.1080    0.8008     1.017
## thickness       1.1055     0.9046    1.0257     1.191
## ulcerPresent    3.3021     0.3028    1.8012     6.054
## 
## Concordance= 0.757  (se = 0.04 )
## Rsquare= 0.195   (max possible= 0.937 )
## Likelihood ratio test= 44.4  on 5 df,   p=1.922e-08
## Wald test            = 40.89  on 5 df,   p=9.88e-08
## Score (logrank) test = 48.14  on 5 df,   p=3.328e-09</code></pre>
<p>If we do the same with a split dataset:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">spl_melanoma &lt;-
<span class="st">  </span>melanoma <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">timeSplitter</span>(<span class="dt">by =</span> .<span class="dv">5</span>,
               <span class="dt">event_var =</span> <span class="st">&quot;status&quot;</span>,
               <span class="dt">event_start_status =</span> <span class="st">&quot;Alive&quot;</span>,
               <span class="dt">time_var =</span> <span class="st">&quot;time&quot;</span>,
               <span class="dt">time_related_vars =</span> <span class="kw">c</span>(<span class="st">&quot;age&quot;</span>, <span class="st">&quot;year&quot;</span>))

interval_model &lt;-
<span class="st">  </span><span class="kw">update</span>(regular_model, 
         <span class="kw">Surv</span>(Start_time, Stop_time, status <span class="op">==</span><span class="st"> &quot;Died from melanoma&quot;</span>) <span class="op">~</span><span class="st"> </span>.,
         <span class="dt">data =</span> spl_melanoma)

<span class="kw">summary</span>(interval_model)</code></pre></div>
<pre><code>## Call:
## coxph(formula = Surv(Start_time, Stop_time, status == &quot;Died from melanoma&quot;) ~ 
##     age + sex + year + thickness + ulcer, data = spl_melanoma, 
##     x = TRUE, y = TRUE)
## 
##   n= 2522, number of events= 57 
## 
##                   coef exp(coef)  se(coef)      z Pr(&gt;|z|)    
## age           0.016805  1.016947  0.008578  1.959 0.050094 .  
## sexMale       0.448121  1.565368  0.266861  1.679 0.093107 .  
## year         -0.102566  0.902518  0.061007 -1.681 0.092719 .  
## thickness     0.100312  1.105516  0.038212  2.625 0.008660 ** 
## ulcerPresent  1.194555  3.302087  0.309254  3.863 0.000112 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
##              exp(coef) exp(-coef) lower .95 upper .95
## age             1.0169     0.9833    1.0000     1.034
## sexMale         1.5654     0.6388    0.9278     2.641
## year            0.9025     1.1080    0.8008     1.017
## thickness       1.1055     0.9046    1.0257     1.191
## ulcerPresent    3.3021     0.3028    1.8012     6.054
## 
## Concordance= 0.757  (se = 0.04 )
## Rsquare= 0.017   (max possible= 0.201 )
## Likelihood ratio test= 44.4  on 5 df,   p=1.922e-08
## Wald test            = 40.89  on 5 df,   p=9.88e-08
## Score (logrank) test = 48.14  on 5 df,   p=3.328e-09</code></pre>
<p>As you can see the difference between the models is negligible:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(htmlTable)
<span class="kw">cbind</span>(<span class="dt">Regular =</span> <span class="kw">coef</span>(regular_model),
      <span class="dt">Interval =</span> <span class="kw">coef</span>(interval_model),
      <span class="dt">Difference =</span> <span class="kw">coef</span>(regular_model) <span class="op">-</span><span class="st"> </span><span class="kw">coef</span>(interval_model)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">txtRound</span>(<span class="dt">digits =</span> <span class="dv">5</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>knitr<span class="op">::</span><span class="kw">kable</span>(<span class="dt">align =</span> <span class="st">&quot;r&quot;</span>)</code></pre></div>
<table>
<thead>
<tr class="header">
<th></th>
<th align="right">Regular</th>
<th align="right">Interval</th>
<th align="right">Difference</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>age</td>
<td align="right">0.01681</td>
<td align="right">0.01681</td>
<td align="right">0.00000</td>
</tr>
<tr class="even">
<td>sexMale</td>
<td align="right">0.44812</td>
<td align="right">0.44812</td>
<td align="right">0.00000</td>
</tr>
<tr class="odd">
<td>year</td>
<td align="right">-0.10257</td>
<td align="right">-0.10257</td>
<td align="right">0.00000</td>
</tr>
<tr class="even">
<td>thickness</td>
<td align="right">0.10031</td>
<td align="right">0.10031</td>
<td align="right">0.00000</td>
</tr>
<tr class="odd">
<td>ulcerPresent</td>
<td align="right">1.19455</td>
<td align="right">1.19455</td>
<td align="right">0.00000</td>
</tr>
</tbody>
</table>
<p>Now we can look for time varying coefficients using the <code>survival::cox.zph()</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cox.zph</span>(regular_model) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">extract2</span>(<span class="st">&quot;table&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">txtRound</span>(<span class="dt">digits =</span> <span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>knitr<span class="op">::</span><span class="kw">kable</span>(<span class="dt">align =</span> <span class="st">&quot;r&quot;</span>)</code></pre></div>
<table>
<thead>
<tr class="header">
<th></th>
<th align="right">rho</th>
<th align="right">chisq</th>
<th align="right">p</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>age</td>
<td align="right">0.18</td>
<td align="right">2.48</td>
<td align="right">0.12</td>
</tr>
<tr class="even">
<td>sexMale</td>
<td align="right">-0.16</td>
<td align="right">1.49</td>
<td align="right">0.22</td>
</tr>
<tr class="odd">
<td>year</td>
<td align="right">0.06</td>
<td align="right">0.20</td>
<td align="right">0.65</td>
</tr>
<tr class="even">
<td>thickness</td>
<td align="right">-0.23</td>
<td align="right">2.54</td>
<td align="right">0.11</td>
</tr>
<tr class="odd">
<td>ulcerPresent</td>
<td align="right">-0.17</td>
<td align="right">1.63</td>
<td align="right">0.20</td>
</tr>
<tr class="even">
<td>GLOBAL</td>
<td align="right"></td>
<td align="right">10.30</td>
<td align="right">0.07</td>
</tr>
</tbody>
</table>
<p>The two variable that give a hint of time variation are age and thickness. It seems reasonable that melanoma thickness is less important as time increases, either the tumor was adequately removed or there was some remaining piece that caused the patient to die within a few years. We will therefore add a time interaction using the <code>:</code> variant (<strong>note</strong> using the <code>*</code> for interactions gives a separate variable for the time and that is not of interest in this case):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">time_int_model &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">update</span>(interval_model,
         .<span class="op">~</span>.<span class="op">+</span>thickness<span class="op">:</span>Start_time)
<span class="kw">summary</span>(time_int_model)</code></pre></div>
<pre><code>## Call:
## coxph(formula = Surv(Start_time, Stop_time, status == &quot;Died from melanoma&quot;) ~ 
##     age + sex + year + thickness + ulcer + thickness:Start_time, 
##     data = spl_melanoma, x = TRUE, y = TRUE)
## 
##   n= 2522, number of events= 57 
## 
##                           coef exp(coef)  se(coef)      z Pr(&gt;|z|)    
## age                   0.014126  1.014226  0.008591  1.644 0.100115    
## sexMale               0.511881  1.668427  0.268960  1.903 0.057016 .  
## year                 -0.098459  0.906233  0.061241 -1.608 0.107896    
## thickness             0.209025  1.232476  0.061820  3.381 0.000722 ***
## ulcerPresent          1.286214  3.619060  0.313838  4.098 4.16e-05 ***
## thickness:Start_time -0.045630  0.955395  0.022909 -1.992 0.046388 *  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
##                      exp(coef) exp(-coef) lower .95 upper .95
## age                     1.0142     0.9860    0.9973    1.0314
## sexMale                 1.6684     0.5994    0.9848    2.8265
## year                    0.9062     1.1035    0.8037    1.0218
## thickness               1.2325     0.8114    1.0918    1.3912
## ulcerPresent            3.6191     0.2763    1.9564    6.6948
## thickness:Start_time    0.9554     1.0467    0.9134    0.9993
## 
## Concordance= 0.762  (se = 0.04 )
## Rsquare= 0.019   (max possible= 0.201 )
## Likelihood ratio test= 48.96  on 6 df,   p=7.608e-09
## Wald test            = 45.28  on 6 df,   p=4.121e-08
## Score (logrank) test = 56.29  on 6 df,   p=2.541e-10</code></pre>
<p>As suspected the thickness effect is reduced with time. A linear model is hard to explain from a biological standpoint, we may want to see if we can detect if the interaction follows a non-linear trajectory by adding a quadratic variable:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># First we need to manually add an interaction term</span>
spl_melanoma <span class="op">%&lt;&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">thickness_start =</span> thickness <span class="op">*</span><span class="st"> </span>Start_time) 
<span class="kw">anova</span>(time_int_model,
      <span class="kw">update</span>(time_int_model, .<span class="op">~</span>.<span class="op">+</span><span class="kw">I</span>(thickness_start<span class="op">^</span><span class="dv">2</span>)))</code></pre></div>
<pre><code>## Analysis of Deviance Table
##  Cox model: response is  Surv(Start_time, Stop_time, status == &quot;Died from melanoma&quot;)
##  Model 1: ~ age + sex + year + thickness + ulcer + thickness:Start_time
##  Model 2: ~ age + sex + year + thickness + ulcer + I(thickness_start^2) + thickness:Start_time
##    loglik  Chisq Df P(&gt;|Chi|)
## 1 -258.72                    
## 2 -258.51 0.4178  1     0.518</code></pre>
<p>As you can see this doesn’t support that the variable is non-linear. An alternative would be to use the <code>survival::pspline</code> method:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">update</span>(time_int_model, .<span class="op">~</span>.<span class="op">-</span>thickness<span class="op">:</span>Start_time<span class="op">+</span><span class="kw">pspline</span>(thickness_start))</code></pre></div>
<pre><code>## Call:
## coxph(formula = Surv(Start_time, Stop_time, status == &quot;Died from melanoma&quot;) ~ 
##     age + sex + year + thickness + ulcer + pspline(thickness_start), 
##     data = spl_melanoma, x = TRUE, y = TRUE)
## 
##                               coef se(coef)      se2    Chisq   DF       p
## age                        0.01291  0.00857  0.00857  2.26993 1.00 0.13191
## sexMale                    0.49378  0.27138  0.27125  3.31055 1.00 0.06884
## year                      -0.09235  0.06070  0.06068  2.31457 1.00 0.12817
## thickness                  0.15334  0.07679  0.07525  3.98710 1.00 0.04585
## ulcerPresent               1.10814  0.32615  0.32381 11.54370 1.00 0.00068
## pspline(thickness_start), -0.04236  0.02321  0.02314  3.32997 1.00 0.06803
## pspline(thickness_start),                             4.19818 2.99 0.23948
## 
## Iterations: 4 outer, 14 Newton-Raphson
##      Theta= 0.107 
## Degrees of freedom for terms= 1 1 1 1 1 4 
## Likelihood ratio test=54  on 8.93 df, p=1.76e-08  n= 2522</code></pre>
<p>If you are only investigating confounders that you want to adjust for we are done. If you actually want to convey the results to your readers then we need to think about how to display the interaction, especially if they turn out to follow a non-linear pattern. If you have two continuous variables I you have basically two options, go with a 3-dimensional graph that where confidence interval are hard to illustrate or categorize one of the variables and use a regular 2-dimensional graph. I usually go for the latter:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Lets create an evenly distributed categorical thickness variable</span>
<span class="co"># and interactions</span>
spl_melanoma <span class="op">%&lt;&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">thickness_cat =</span> <span class="kw">cut</span>(thickness,
                             <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="ot">Inf</span>),
                             <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;less than 1.0&quot;</span>,
                                        <span class="st">&quot;1.0 to 4.9&quot;</span>,
                                        <span class="st">&quot;at least 5.0&quot;</span>)))
<span class="co"># Now create interaction variables</span>
<span class="cf">for</span> (l <span class="cf">in</span> <span class="kw">levels</span>(spl_melanoma<span class="op">$</span>thickness_cat)[<span class="op">-</span><span class="dv">1</span>]){
  spl_melanoma[[<span class="kw">sprintf</span>(<span class="st">&quot;thickness_%s_time&quot;</span>, <span class="kw">gsub</span>(<span class="st">&quot; &quot;</span>, <span class="st">&quot;_&quot;</span>, l))]] &lt;-<span class="st"> </span>
<span class="st">    </span>(spl_melanoma<span class="op">$</span>thickness_cat <span class="op">==</span><span class="st"> </span>l)<span class="op">*</span>spl_melanoma<span class="op">$</span>Start_time
}

<span class="co"># Now for the model specification where we use a </span>
<span class="co"># pspline for the two interaction variables</span>
adv_int_model &lt;-
<span class="st">  </span><span class="kw">coxph</span>(<span class="kw">Surv</span>(Start_time, Stop_time, status <span class="op">==</span><span class="st"> &quot;Died from melanoma&quot;</span>) <span class="op">~</span><span class="st"> </span>
<span class="st">          </span>age <span class="op">+</span><span class="st"> </span>sex <span class="op">+</span><span class="st"> </span>year <span class="op">+</span><span class="st"> </span>ulcer <span class="op">+</span><span class="st"> </span>
<span class="st">          </span>thickness_cat <span class="op">+</span><span class="st"> </span><span class="kw">pspline</span>(thickness_<span class="fl">1.</span>0_to_<span class="fl">4.</span>9_time) <span class="op">+</span><span class="st"> </span><span class="kw">pspline</span>(thickness_at_least_<span class="fl">5.</span>0_time), 
        <span class="dt">data =</span> spl_melanoma, 
        <span class="dt">x =</span> <span class="ot">TRUE</span>, <span class="dt">y =</span> <span class="ot">TRUE</span>,
        <span class="dt">iter.max =</span> <span class="dv">1000</span>)

<span class="co"># To get the estimates we use the predict function</span>
new_data &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">thickness_cat =</span> <span class="kw">rep</span>(<span class="kw">levels</span>(spl_melanoma<span class="op">$</span>thickness_cat)[<span class="op">-</span><span class="dv">1</span>],
                                           <span class="dt">each =</span> <span class="dv">100</span>),
                       <span class="dt">Start_time =</span> <span class="dv">2</span><span class="op">^</span><span class="kw">seq</span>(<span class="op">-</span><span class="dv">3</span>, <span class="dv">3</span>, <span class="dt">length.out =</span> <span class="dv">100</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">thickness_1.0_to_4.9_time =</span> (thickness_cat <span class="op">==</span><span class="st"> </span><span class="kw">levels</span>(spl_melanoma<span class="op">$</span>thickness_cat)[<span class="dv">2</span>]) <span class="op">*</span>
<span class="st">           </span>Start_time,
         <span class="dt">thickness_at_least_5.0_time =</span> (thickness_cat <span class="op">==</span><span class="st"> </span><span class="kw">levels</span>(spl_melanoma<span class="op">$</span>thickness_cat)[<span class="dv">3</span>]) <span class="op">*</span>
<span class="st">           </span>Start_time)
new_data<span class="op">$</span>sex =<span class="st"> &quot;Female&quot;</span>
new_data<span class="op">$</span>age =<span class="st"> </span><span class="kw">median</span>(melanoma<span class="op">$</span>age)
new_data<span class="op">$</span>year =<span class="st"> </span><span class="kw">median</span>(melanoma<span class="op">$</span>year)
new_data<span class="op">$</span>ulcer =<span class="st"> &quot;Absent&quot;</span>

adv_pred &lt;-<span class="st"> </span><span class="kw">predict</span>(adv_int_model,
                    <span class="dt">newdata =</span> new_data,
                    <span class="dt">type =</span> <span class="st">&quot;terms&quot;</span>,
                    <span class="dt">terms =</span> <span class="kw">c</span>(<span class="st">&quot;thickness_cat&quot;</span>, 
                              <span class="st">&quot;pspline(thickness_1.0_to_4.9_time)&quot;</span>,
                              <span class="st">&quot;pspline(thickness_at_least_5.0_time)&quot;</span>),
                    <span class="dt">se.fit =</span> <span class="ot">TRUE</span>)

new_data<span class="op">$</span>fit &lt;-<span class="st"> </span><span class="kw">rowSums</span>(adv_pred<span class="op">$</span>fit)
new_data<span class="op">$</span>se.fit &lt;-<span class="st"> </span><span class="kw">apply</span>(adv_pred<span class="op">$</span>se.fit, <span class="dv">1</span>, <span class="cf">function</span>(x) x<span class="op">^</span><span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>colSums <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>sqrt
new_data <span class="op">%&lt;&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">risk =</span> <span class="kw">exp</span>(fit),
         <span class="dt">upper =</span> <span class="kw">exp</span>(fit <span class="op">+</span><span class="st"> </span><span class="fl">1.96</span><span class="op">*</span>se.fit),
         <span class="dt">lower =</span> <span class="kw">exp</span>(fit <span class="op">-</span><span class="st"> </span><span class="fl">1.96</span><span class="op">*</span>se.fit))</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)
new_data <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">adapted_risk =</span> <span class="kw">sapply</span>(risk, <span class="cf">function</span>(x) <span class="kw">min</span>(<span class="kw">max</span>(<span class="dv">2</span><span class="op">^-</span><span class="dv">4</span>, x), <span class="dv">2</span><span class="op">^</span><span class="dv">5</span>)),
         <span class="dt">adapted_upper =</span> <span class="kw">sapply</span>(upper, <span class="cf">function</span>(x) <span class="kw">min</span>(<span class="kw">max</span>(<span class="dv">2</span><span class="op">^-</span><span class="dv">4</span>, x), <span class="dv">2</span><span class="op">^</span><span class="dv">5</span>)),
         <span class="dt">adapted_lower =</span> <span class="kw">sapply</span>(lower, <span class="cf">function</span>(x) <span class="kw">min</span>(<span class="kw">max</span>(<span class="dv">2</span><span class="op">^-</span><span class="dv">4</span>, x), <span class="dv">2</span><span class="op">^</span><span class="dv">5</span>))) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">y =</span> adapted_risk, 
             <span class="dt">x =</span> new_data<span class="op">$</span>Start_time, 
             <span class="dt">group =</span> thickness_cat,
             <span class="dt">col =</span> thickness_cat,
             <span class="dt">fill =</span> thickness_cat)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="co"># The confidence intervals are too wide to display in this case</span>
<span class="st">  </span><span class="co"># geom_ribbon(aes(ymax = adapted_upper, ymin = adapted_lower), fill = &quot;red&quot;) + </span>
<span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_log10</span>(<span class="dt">breaks =</span> <span class="dv">2</span><span class="op">^</span>(<span class="op">-</span><span class="dv">3</span><span class="op">:</span><span class="dv">4</span>),
                <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">2</span><span class="op">^-</span><span class="dv">3</span>, <span class="dv">8</span>),
                <span class="dt">expand =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">scale_y_log10</span>(<span class="dt">breaks =</span> <span class="dv">2</span><span class="op">^</span>(<span class="op">-</span><span class="dv">4</span><span class="op">:</span><span class="dv">5</span>), 
                <span class="dt">labels =</span> <span class="kw">txtRound</span>(<span class="dv">2</span><span class="op">^</span>(<span class="op">-</span><span class="dv">4</span><span class="op">:</span><span class="dv">5</span>), <span class="dv">2</span>),
                <span class="dt">expand=</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_color_brewer</span>(<span class="dt">type =</span> <span class="st">&quot;qual&quot;</span>, <span class="dt">guide =</span> <span class="kw">guide_legend</span>(<span class="dt">title =</span> <span class="st">&quot;Thickness (mm)&quot;</span>)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Hazard ratio&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Time (years)&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>()</code></pre></div>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
<div id="a-few-tips-and-notes" class="section level1">
<h1>A few tips and notes</h1>
<div id="drop-unnecessary-variables" class="section level2">
<h2>Drop unnecessary variables</h2>
<p>The main problem is the memory usage with both the <code>tt</code> and the <code>timeSplitter</code> approach. Make therefore sure to drop <strong>all</strong> variables that you won’t be using before doing your regression. I’ve found that dropping variables not only limits the risk of running out of memory but also considerably speeds up the regressions.</p>
</div>
<div id="choose-adequate-interval-length" class="section level2">
<h2>Choose adequate interval length</h2>
<p>Longer interval lengths will reduce the size of the split dataset but will increase the risk of residual non-proportional hazards. When I consulted a statistician on a dataset containing followup 0 to 21 years, she recommended that I have ½ year intervals. I think this was slightly overdoing it, I guess an alternative would have been to simply redo the <code>cox.zph</code> call in order to see how well the new model takes care of the non-proportionality problem.</p>
</div>
<div id="using-the-time-splitted-model" class="section level2">
<h2>Using the time-splitted model</h2>
<p>Explaining the time coefficient can be demanding. I often rely on the <code>rms::contrast</code> function but this can be tricky since the <code>Start_time</code> can confuse the <code>contrast</code> function.</p>
</div>
<div id="warning-dont-use-the-i-option" class="section level2">
<h2>Warning: don’t use the <code>I()</code> option</h2>
<p>Just to be crystal clear, the <code>I()</code> option should never be used. It will provide spuriously low p-values and doesn’t solve the non-proportionality issue. See Therneau’s vignette for more on this.</p>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
